<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="refresh" content="0;https://zemlan.in/cache-already-done.html">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="alternate" type="application/rss+xml" title="Everything feed - zemlan.in" href="https://zemlan.in/rss.xml" />
  <link href="https://twitter.com/zemlanin" rel="me">
  <link href="https://github.com/zemlanin" rel="me">
  <title>
    Cache Already Done
 - 
    zemlan.in
  </title>
  <style type="text/css">
body{max-width:40em;margin:auto;display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;font-size:20px;line-height:1.58;padding-left:.75em;padding-right:.75em}@supports (padding:max(0px)){body{padding-left:max(.75em,env(safe-area-inset-left));padding-right:max(.75em,env(safe-area-inset-right))}}body.dark{background-color:#000;color:#e3e3e3}body.light{background-color:#fff;color:#000}h1,h2,h3{margin:.5em 0;line-height:1.3}p{margin:.8em 0}*{box-sizing:border-box}article{margin-bottom:3em;max-width:100%;overflow-wrap:break-word}article img,article video{max-width:100%;width:auto;max-height:30em;height:auto;display:block;margin:auto}article a.future-frame,article iframe{display:block;margin:auto;max-width:100%}@media (max-width:40em){body{padding-bottom:1em;font-size:17px}@supports (padding:max(0px)){body{padding-bottom:max(1em,env(safe-area-inset-bottom))}}article img,article video{max-height:22.5em}}article iframe[src*="music.apple.com/"]{max-width:calc(100% - .1em)}article a.future-frame{position:relative}article a[href*="youtube.com/"].future-frame:after{position:absolute;width:64px;height:64px;top:50%;left:50%;transform:translate(-50%,-50%);content:"";background-image:url("data:image/svg+xml;utf8,    <svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 1024 721' enable-background='new 0 0 1024 721' xml:space='preserve'>    <path fill='white' d='M407,493l276-143L407,206V493z'/>    <path fill='red' d='M1013,156.3c0,0-10-70.4-40.6-101.4C933.6,14.2,890,14,870.1,11.6C727.1,1.3,512.7,1.3,512.7,1.3 h-0.4c0,0-214.4,0-357.4,10.3C135,14,91.4,14.2,52.6,54.9C22,85.9,12,156.3,12,156.3S1.8,238.9,1.8,321.6v77.5 C1.8,481.8,12,564.4,12,564.4s10,70.4,40.6,101.4c38.9,40.7,89.9,39.4,112.6,43.7c81.7,7.8,347.3,10.3,347.3,10.3 s214.6-0.3,357.6-10.7c20-2.4,63.5-2.6,102.3-43.3c30.6-31,40.6-101.4,40.6-101.4s10.2-82.7,10.2-165.3v-77.5 C1023.2,238.9,1013,156.3,1013,156.3z M407,493V206l276,144L407,493z'/>  </svg>");background-repeat:no-repeat;background-position:center}article a[href$=".pdf"][data-src*="https://drive.google.com/viewerng/viewer"].future-frame:after{position:absolute;width:24px;height:32px;bottom:16px;right:16px;content:"";border:4px solid #fff;border-radius:4px;background-color:#fff;background-image:url("data:image/svg+xml;utf8,    <svg xmlns='http://www.w3.org/2000/svg' version='1.1' viewBox='0 0 384 512' enable-background='new 0 0 384 512' xml:space='preserve'>    <path fill='%2300a500' d='M181.9 256.1c-5-16-4.9-46.9-2-46.9 8.4 0 7.6 36.9 2 46.9zm-1.7 47.2c-7.7 20.2-17.3 43.3-28.4 62.7 18.3-7 39-17.2 62.9-21.9-12.7-9.6-24.9-23.4-34.5-40.8zM86.1 428.1c0 .8 13.2-5.4 34.9-40.2-6.7 6.3-29.1 24.5-34.9 40.2zM248 160h136v328c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V24C0 10.7 10.7 0 24 0h200v136c0 13.2 10.8 24 24 24zm-8 171.8c-20-12.2-33.3-29-42.7-53.8 4.5-18.5 11.6-46.6 6.2-64.2-4.7-29.4-42.4-26.5-47.8-6.8-5 18.3-.4 44.1 8.1 77-11.6 27.6-28.7 64.6-40.8 85.8-.1 0-.1.1-.2.1-27.1 13.9-73.6 44.5-54.5 68 5.6 6.9 16 10 21.5 10 17.9 0 35.7-18 61.1-61.8 25.8-8.5 54.1-19.1 79-23.2 21.7 11.8 47.1 19.5 64 19.5 29.2 0 31.2-32 19.7-43.4-13.9-13.6-54.3-9.7-73.6-7.2zM377 105L279 7c-4.5-4.5-10.6-7-17-7h-6v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-74.1 255.3c4.1-2.7-2.5-11.9-42.8-9 37.1 15.8 42.8 9 42.8 9z'></path>  </svg>");background-repeat:no-repeat;background-position:center}@keyframes loadingopacity{from{opacity:.3}to{opacity:1}}article a.future-frame.loading:after{animation:.8s ease-in-out infinite alternate-reverse loadingopacity}article time{display:block;text-align:right;font-size:.9em}article time a{color:gray;text-decoration:none}article time svg{width:1em;height:1em}article blockquote{margin-left:0;margin-right:0;padding-left:.7em;border-left:2px solid rgba(0,165,0,.7)}footer,nav{margin-bottom:1em}footer{text-align:center}nav{display:flex;flex-flow:row;justify-content:space-between;word-break:break-word}nav span{flex-basis:0;flex-grow:1}article code{border:1px solid #dedede;padding:.1em .2em;font-size:.9em;font-family:"SF Mono",Menlo-Regular,Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;word-break:keep-all}article pre code{border:none;padding:0;word-wrap:normal;font-size:.8em}article pre{border:1px solid #dedede;padding:.2em .4em;overflow-x:scroll;line-height:1.5}body.dark article code,body.dark article pre{border-color:#414141}body.light article code,body.light article pre{border-color:#dedede}article a.more,article h1 a,article h2 a,article h3 a{text-decoration:none}a,footer a:visited,header a:visited{color:#00a500;-webkit-text-decoration-color:rgba(0,165,0,.6);text-decoration-color:rgba(0,165,0,.6)}@media (prefers-color-scheme:dark){body{background-color:#000;color:#e3e3e3}article code,article pre{border-color:#414141}body a{-webkit-text-decoration-color:rgba(0,165,0,.8);text-decoration-color:rgba(0,165,0,.8)}}body.dark a{-webkit-text-decoration-color:rgba(0,165,0,.8);text-decoration-color:rgba(0,165,0,.8)}body.light a{-webkit-text-decoration-color:rgba(0,165,0,.6);text-decoration-color:rgba(0,165,0,.6)}footer a,header a,nav a{text-decoration:none}footer a,nav a{display:inline-block;padding-left:1em;padding-right:1em}header{display:flex;flex-direction:row;align-items:center;justify-content:flex-start}header h1,header h2{flex-grow:1;flex-shrink:1;display:flex;flex-flow:row wrap;word-break:break-all}header h1{font-size:1.5em}header h2{font-size:1.3em}@media print{body{font-size:14px;max-width:100%;padding:0}article p{page-break-inside:avoid}.print\:hidden,footer,header label,nav{display:none}}.hljs-comment{color:#888}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-meta-keyword,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-title{font-weight:700}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}  </style>
  <script type="text/javascript">
document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("night-mode"),e=document.body.classList,d=document.cookie&&document.cookie.match(/(^|; )night-mode=1(;|$)/),n=document.cookie&&document.cookie.match(/(^|; )night-mode=0(;|$)/);t.checked=d||window.matchMedia("(prefers-color-scheme: dark)").matches&&!n,d?e.add("dark"):n&&e.add("light"),t.addEventListener("change",function(){t.checked?(e.add("dark"),e.remove("light"),document.cookie="night-mode=1; path=/"):(e.remove("dark"),e.add("light"),document.cookie="night-mode=0; path=/")}),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){t.checked=e.matches})}),document.addEventListener("DOMContentLoaded",function(){function n(e){if(e.ctrlKey||e.metaKey)return!0;var t=e.currentTarget;t.removeEventListener("click",n),t.classList.add("loading");var d=document.createElement("iframe");d.setAttribute("src",t.getAttribute("data-src")),d.setAttribute("frameborder",0),d.setAttribute("width",640),d.setAttribute("height",0),d.setAttribute("allow","autoplay; encrypted-media"),d.setAttribute("allowfullscreen",1),t.parentNode.insertBefore(d,t),d.addEventListener("load",function(){d.setAttribute("height",360),t.style.display="none"}),e.preventDefault()}Array.prototype.forEach.call(document.querySelectorAll("a.future-frame[data-src]"),function(e){e.addEventListener("click",n)})});  </script>
<script type="text/javascript"
  async
  id="gauges-tracker"
  data-site-id="5843fd0cbb922a42d6006514"
  data-track-path="//track.gaug.es/track.gif"
  src="//d36ee2fcip1434.cloudfront.net/track.js"
></script>
</head>
<body>
  <header>
      <h2>
        <a href="https://zemlan.in/">zemlan.in</a>
        <span class="print:hidden">&nbsp;/&nbsp;<span><a href="https://zemlan.in/cache-already-done.html" class="print:hidden">&infin;</a>
      </h2>

    <label>
      <input type="checkbox" id="night-mode" />
      <svg role='img' xmlns='http://www.w3.org/2000/svg' style="vertical-align: middle;" width="1em" height="1em" viewBox='0 0 512 512'><path fill='#888' d='M272 428v28c0 10.449-6.68 19.334-16 22.629V488c0 13.255-10.745 24-24 24h-80c-13.255 0-24-10.745-24-24v-9.371c-9.32-3.295-16-12.18-16-22.629v-28c0-6.627 5.373-12 12-12h136c6.627 0 12 5.373 12 12zm-143.107-44c-9.907 0-18.826-6.078-22.376-15.327C67.697 267.541 16 277.731 16 176 16 78.803 94.805 0 192 0s176 78.803 176 176c0 101.731-51.697 91.541-90.516 192.673-3.55 9.249-12.47 15.327-22.376 15.327H128.893zM112 176c0-44.112 35.888-80 80-80 8.837 0 16-7.164 16-16s-7.163-16-16-16c-61.757 0-112 50.243-112 112 0 8.836 7.164 16 16 16s16-7.164 16-16z'></path></svg>
    </label>
  </header>
  <main>

<article>
  <h1 id="cache-already-done"><a href="https://zemlan.in/cache-already-done.html">Cache Already Done</a></h1>
<h3 id="previously">Previously</h3>
<p>Зимой я рассказывал про то, что <a href="https://zemlan.in/api-already-done.html">в HTTP уже есть механизмы для отдачи/загрузки данных частями, для авторизации и для кэширования</a>. Сейчас я бы хотел рассказать о последнем с более практической точки зрения</p>
<h3 id="intro">Intro</h3>
<p><img src="https://zemlan.in/media/4ayKGlmYYzr3I5LtNHxCK2GASf.png" alt=""></p>
<p>Меня зовут <a href="https://anton.codes">Антон</a>, я работаю в компании <a href="https://evo.company">Evo</a> и делаю сервис пользовательского фидбека Colbert (Колбер)</p>
<h3 id="-">Суть сервиса/проблемы</h3>
<p><img src="https://zemlan.in/media/bFe3koB3D1FktqfA7fcMxCC4d5.png" alt=""></p>
<p>Суть сервиса заключается в том, что «хозяева» сайта встраивают колберовский <code>&lt;script&gt;</code> и получают возможность задавать те или иные вопросы на каждой своей странице. Чтобы получить эти вопросы, скрипт стучится на сервер. Сервер отдаёт (приблизительно) все опросы на этом сайте, на которые посетитель ещё не отвечала, и уже скрипт решает, нужно ли показать опрос про качество поиска или про опыт заказа</p>
<p>То есть, ответ сервера обновляется намного реже, чем приходят запросы (потому что редактирование опросов и ответы того или иного посетителя реже, чем переход по страницам). Идеальная кандидатура для кэширования</p>
<h3 id="-">Свежесть / Валидность</h3>
<p>В HTTP есть две группы хэдеров про кэширование: «свежесть» и «валидация»</p>
<h3 id="-">Свежесть</h3>
<p>Первая группа указывает на то, что клиент (браузер) может некоторое время после получения ответа не обращаться к серверу и переиспользовать данные из этого ответа. То есть, может <strong>вообще</strong> не обращаться. Эти хэдеры экономят сетевые запросы, трафик <em>и</em> серверное время</p>
<p>К этой группе относятся <code>Cache-Control: max-age=N</code>, <code>Expires</code> и, в каком-то смысле, <code>Last-Modified</code> (браузеры кэшируют ответы с ним и с <code>Date</code> на время <code>t = (Date - LastModified) / 10</code>)</p>
<p>Отдельно упомяну про то, что <code>Cache-Control: max-age=N</code> начинает отсчёт не по локальным часам, а по значению <code>Date</code>. Так что, если у вас на сервере неправильно настроено время (или вы тестируете сервер внутри VirtualBox’а, где течение времени может заметно отставать от реального), проверка на «свежесть» может не работать. Или перестать работать. Или работать слишком агрессивно, устанавливая инвалидацию в <em>очень</em> далёком будущем, но об этом потом</p>
<h3 id="-">Валидность</h3>
<p>Вторая группа служит для сравнения кэша браузера с новым ответом сервера (если он всё-таки был сделан после проверки на «свежесть»)</p>
<p>К этой группе относятся хэдеры <code>ETag</code> (в ответе сервера) / <code>If-None-Match</code> (в запросе клиента) и <code>Last-Modified</code> / <code>If-Modified-Since</code>. Эти хэдеры помогут экономить на трафике и, если оптимизировать загрузку данных на самом сервере, серверное время — сетевые запросы всё равно будут выполняться. Нужно же как-то получить актуальное значение <code>ETag</code> / <code>Last-Modified</code> от сервера</p>
<p>Сама валидация происходит на сервере, путём сравнения значений <code>If-None-Match</code> и / или <code>If-Modified-Since</code> (которые автоматически отправляются браузерами, если ресурс ранее отдавался с хэдерами <code>ETag</code> и / или <code>Last-Modified</code> соответственно) со значениями, которые вычислил сервер для ответа</p>
<p>Оно звучит немного запутано на словах, но понятнее в коде</p>
<h3 id="practice">Practice</h3>
<p><em>Сервер Колбера написан на Python, так что примеры будут на нём</em></p>
<pre><code class="lang-python">resp_body = {
    <span class="hljs-string">'questionnaires'</span>: get_questionnaires(),
}
json_resp = json.dumps(resp_body).encode(<span class="hljs-string">'utf-8'</span>)
etag = <span class="hljs-string">f'W/"<span class="hljs-subst">{hashlib.sha1(json_body).hexdigest()[:<span class="hljs-number">8</span>]}</span>"'</span>

resp_headers = {
    <span class="hljs-string">'cache-control'</span>: <span class="hljs-string">'private, max-age=120'</span>,
    <span class="hljs-string">'etag'</span>: etag,
    <span class="hljs-comment"># spoilers:</span>
    <span class="hljs-comment"># 'vary': 'Origin, Cookie'</span>
}

<span class="hljs-keyword">if</span> req.headers.get(<span class="hljs-string">'if-none-match'</span>) == etag:
    <span class="hljs-keyword">return</span> web.HTTPNotModified(  <span class="hljs-comment"># Status: 304</span>
        headers=resp_headers,
    )

<span class="hljs-keyword">return</span> web.HTTPOk(  <span class="hljs-comment"># Status: 200</span>
    body=json_resp,
    content_type=<span class="hljs-string">'application/json'</span>,
    headers=resp_headers,
)
</code></pre>
<p>Кэши есть не только у браузеров, но и у CDN, reverse proxy, load balancer’ов… Для того, чтобы они не вздумали кэшировать ответы сервера, предназначенные для определённого посетителя, нужен хэдер <code>Cache-Control: private</code></p>
<h3 id="-set-cookie-">Хэдер <code>Set-Cookie</code> в ответе сервера</h3>
<p>Браузер кэширует не только тело ответа сервера (в котором находится заветный JSON’чик), но и <strong>все</strong> хэдеры. В том числе и хэдер <code>Set-Cookie</code>, который устанавливает куки. Если этот хэдер есть в кэшируемом ответе, то браузер может:</p>
<ol>
<li>либо не кэшировать ответ</li>
<li>либо кэшировать его и делать <code>Set-Cookie</code> <strong>при каждом обращении к кэшу</strong></li>
</ol>
<p>Оба таких поведения довольно нежелательны (конечно, второй <em>сильно</em> хуже первого, так как не только нагружает сервер, но и может ломать авторизацию). Поэтому, если добавляете один из хэдеров про «свежесть» (<code>Cache-Control: max-age=N</code>, <code>Expires</code> и/или <code>Last-Modified</code>), то <strong>ни в коем случае не устанавливайте их одновременно</strong> <code>Set-Cookie</code></p>
<pre><code class="lang-python"><span class="hljs-keyword">if</span> should_set_some_cookie:
    response.set_cookie(<span class="hljs-string">'some_cookie'</span>, value)

    <span class="hljs-comment"># shouldn't cache responses with Set-Cookie</span>
    <span class="hljs-keyword">if</span> <span class="hljs-string">'cache-control'</span> <span class="hljs-keyword">in</span> response.headers:
        <span class="hljs-keyword">del</span> response.headers[<span class="hljs-string">'cache-control'</span>]

    <span class="hljs-keyword">if</span> <span class="hljs-string">'etag'</span> <span class="hljs-keyword">in</span> response.headers:
        <span class="hljs-keyword">del</span> response.headers[<span class="hljs-string">'etag'</span>]
</code></pre>
<p>Внимательная читательница скажет, что «Но, если мы на каждый ответ авторизованному посетителю обновляем ему <code>auth</code>-куку, то кэширование же никогда не сработает». Да, не сработает. Потому что <strong>не надо ставить</strong> <code>Set-Cookie</code> на каждый ответ (даже если не настраиваете кэширование) </p>
<h3 id="-">Инвалидация</h3>
<p>Юморной же читатель уже давно хочет пошутить про «две главных проблемы программирования». На Колбере есть два повода инвалидации кэша:</p>
<ol>
<li>обновился список активных опросов (текст, статус активности и т.п.)</li>
<li>посетитель уже ответил на один из опросов</li>
</ol>
<p>Первая причина частично решается обновлением <code>ETag</code>, частично — извинением перед редакторами опросов «ваши изменения будут видны посетителям сайта в течении двух минут»</p>
<p>После ответов же посетителя, извинением не обойтись — нужно обязательно прятать опрос. Есть несколько способов это делать. Например, записывать в <code>localStorage</code> айдишники уже отвеченных опросов. Но, раз уж пишу про HTTP-хэдеры, то воспользуемся ими</p>
<h3 id="vary"><code>Vary</code></h3>
<p>По умолчанию, браузеры идентифицируют кэшируемые ресурсы по их URL’ам и HTTP-методам (<code>GET</code>, <code>POST</code> и так далее).  Другой URL — другой ресурс — другой кэш</p>
<p>Но ресурсы для кэширования можно идентифицировать и с помощью хэдеров запроса благодаря хэдеру ответа <code>Vary</code>. Например, можно сделать так, что CORS-запросы с сайта <code>example.com</code> будут кэшироваться отдельно от запросов с сайта <code>example.org</code> с помощью хэдера <code>Vary: Origin</code></p>
<p>Обратно к примеру Колбера. Сервер, кроме <code>Cache-Control</code> и <code>ETag</code>, устанавливает хэдер <code>Vary: Origin, Cookie</code></p>
<p>Когда посетитель отвечает на вопрос, мы устанавливаем ей куку <code>latest_action</code> с таймстампом HTTP-запроса. Кука меняется, кэш опросов инвалидируется, проблема решена</p>
<h3 id="danger-zone">Danger Zone</h3>
<p>Но может возникнуть ситуация, когда выполнить инвалидацию будет невозможно. Например, время на сервере часы установлены в далёкое будущее. Тогда сколько бы браузер ни <code>fetch</code>ил бы ресурс, ему будет возвращаться значение из кэша</p>
<p>Насколько я знаю, в браузерах нет надёжного и / или простого способа инвалидировать кэши из Javascript’ового кода (<em>ServiceWorker’ы, имхо, ещё не обладают достаточной поддержкой и / или простотой использования</em>). Либо пользователь должен лично сбросить кэш (нажатием <code>Cmd+Shift+R</code>, <code>Ctrl-F5</code> или другого подобного «аккорда»), либо скрипт должен обращаться к другому ресурсу (т.е., нужно поменять URL ресурса и / или один из хэдеров, перечисленных в <code>Vary</code>)</p>
<p>Кейсов для кэширования огромное множество и одного универсального способа для исправления таких ошибок нет. Поэтому могу только посоветовать:</p>
<ol>
<li>Учитывать пользователей со слишком старым кэшем при разработке (а такие <em>обязательно</em> будут) и что делать в таком случае</li>
<li>Тщательно тестировать и дебажить кэширование</li>
</ol>
<h3 id="-">Дебаг</h3>
<p>Юзайте ДевТулзы ¯\_(ツ)_/¯</p>
<hr>
<p><img src="https://zemlan.in/media/PyF36DbBbeAODE5kJG6X3UhQam.png" alt=""></p>
<p>Браузеры отдельно кэшируют Preflight <code>OPTIONS</code>-запрос для <code>CORS</code>а, так что он может не выполняться при форсированном обновлении (<code>Cmd+Shift+R</code>). Жмите <code>Disable cache</code>, чтобы полностью сбросить кэш</p>
<hr>
<p><img src="https://zemlan.in/media/bu9w11mQiHRyX4MyNcFfev3xhU.png" alt=""></p>
<p>Пока кэш свежий, браузер отдаёт ресурс <code>(for disk cache)</code></p>
<hr>
<p><img src="https://zemlan.in/media/vf7gUrgCQFF0CMl827D4IPUnZy.png" alt=""></p>
<p>Когда кэш просрочился, браузер сделал запрос с <code>If-None-Match</code>, на что сервер вернул ответ без тела (<em>начальный ответ был 1.8 KB, последний же — всего 388 B</em>) и со статусом <code>304 Not Modified</code></p>
<hr>
<p><img src="https://zemlan.in/media/pOIiLTOmTmhIenkZOXGQdWpQWD.png" alt=""></p>
<p>После <code>304</code>, браузер обновил хэдеры закэшированного ответа и снова отдаёт его <code>(from disk cache)</code></p>
<hr>
<p><img src="https://zemlan.in/media/Tp39wVwfvgwzgFjSiAvSjdQt9p.png" alt=""></p>
<p>В Хроме и Firefox есть страница about:cache, на которой можно детально изучить, что же именно закэшировал браузер</p>
<p>И не тестируйте кэшируемые эндпоинт, внаглую открыв его URL в браузере. Когда вы обновляете (<code>Cmd+R</code>/<code>F5</code>) страницу, браузеры игнорируют её «свежесть» и/или «валидность». Например, Хром сделает сетевой запрос с хэдером <code>ETag</code> даже если прошлый ответ ещё не был просрочен</p>
<h3 id="-">Профит</h3>
<p>Так зачем всё это? Какой профит?</p>
<p>После того, как Колбер начал работать с четырьмя хэдерами перечисленными здесь (<code>Cache-Control</code>, <code>ETag</code>, <code>Vary</code> и <code>If-None-Match</code>; шестью, если считать <code>Set-Cookie</code> и <code>Cookie</code>), количество запросов уменьшилось в три раза. И это с <em>очень</em> осторожной «свежестью» в две минуты</p>
<p><img src="https://zemlan.in/media/E3ryKR1s9ngk1mIXrV8X9MGZTy.png" alt=""></p>
<p>Недавно Колбера включили на <a href="https://prom.ua">Проме</a> и других сестринских проектах, где трафик в разы больше суммарного трафика сайтов, на которых Колбер был подключен на тот момент. О чём я узнал не из-за пятисотых ошибок, а из случайного разговора с коллегой. Сомневаюсь, что запуск получился бы насколько же гладким без этих хэдеров</p>
<h3 id="-">Спасибо</h3>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching">https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Conditional_requests">https://developer.mozilla.org/en-US/docs/Web/HTTP/Conditional_requests</a></li>
<li><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching">https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching</a></li>
</ul>


  <time datetime="2017-10-02T16:38:00Z">
    <a href="https://zemlan.in/cache-already-done.html" title="2017-10-02T16:38:00Z">
      2017-10-02
    </a>
  </time>
</article>

  </main>
  <nav>
    
    <span></span>
    
    <span></span>
  </nav>
  <footer>
    <a href="https://anton.codes" rel="me">Anton Verinov</a>
    <a href="https://twitter.com/zemlanin" rel="me">@zemlanin</a>
    <br/><br/>
    <a href="https://zemlan.in/archive.html">archive</a>
    <a href="https://zemlan.in/rss.xml">rss</a>
    <a href="https://zemlan.in/backstage">
      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" style="vertical-align:middle" viewBox="0 0 640 512"><path fill="rgba(192,192,192,0.5)" d="M624 448h-80V113.45C544 86.19 522.47 64 496 64H384v64h96v384h144c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM312.24 1.01l-192 49.74C105.99 54.44 96 67.7 96 82.92V448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h336V33.18c0-21.58-19.56-37.41-39.76-32.17zM264 288c-13.25 0-24-14.33-24-32s10.75-32 24-32 24 14.33 24 32-10.75 32-24 32z"></path></svg>
    </a>
  </footer>
</body>
</html>
